<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"
       default-autowire="constructor">

    <!-- general services -->
    <bean class="jetbrains.buildServer.runners.ArgumentsServiceImpl"/>
    <bean class="jetbrains.buildServer.runners.ParametersServiceImpl"/>
    <bean class="jetbrains.buildServer.runners.FileSystemServiceImpl"/>
    <bean class="jetbrains.buildServer.runners.PathsServiceImpl"/>
    <bean class="jetbrains.buildServer.runners.LoggerServiceImpl"/>
    <bean class="jetbrains.buildServer.runners.AntPathMatcher"/>
    <bean class="jetbrains.buildServer.runners.LayeredWorkflowComposer" id="layeredWorkflowComposer"/>
    <bean class="jetbrains.buildServer.runners.WorkflowSessionImpl" scope="prototype">
        <constructor-arg ref="layeredWorkflowComposer"/>
    </bean>
    <bean class="jetbrains.buildServer.runners.XmlDocumentServiceImpl"/>

    <!-- plugin -->
    <bean class="jetbrains.buildServer.runners.WorkflowBuildServiceFactory">
        <constructor-arg value="dotnet"/>
    </bean>
    <bean class="jetbrains.buildServer.dotnet.DotnetToolProvider"/>
    <bean class="jetbrains.buildServer.dotnet.DotnetPropertiesExtension"/>
    <bean class="jetbrains.buildServer.dotnet.DotnetCacheCleaner"/>

    <!-- dotnet workflow composer -->
    <bean class="jetbrains.buildServer.dotnet.DotnetWorkflowComposer" id="dotnetWorkflowComposer">
        <constructor-arg ref="dotnetCommandSet"/>
    </bean>
    <bean class="jetbrains.buildServer.dotnet.DotnetSdkVersionProviderImpl"/>
    <bean class="jetbrains.buildServer.dotnet.EnvironmentVariablesImpl"/>
    <bean class="jetbrains.buildServer.dotnet.LoggerResolverImpl"/>

    <!--Dotnet arguments' providers-->
    <bean class="jetbrains.buildServer.dotnet.DotnetCommandSet" id="dotnetCommandSet"/>
    <bean class="jetbrains.buildServer.dotnet.TargetServiceImpl" />
    <bean class="jetbrains.buildServer.dotnet.CustomArgumentsProvider" id="dotnetCustomArgumentsProvider" />
    <bean class="jetbrains.buildServer.dotnet.DotnetToolResolverImpl" id="dotnetToolResolver" />
    <bean class="jetbrains.buildServer.dotnet.MSBuildToolResolver" id="msbuildToolResolver">
        <constructor-arg ref="dotnetToolResolver"/>
    </bean>
    <bean class="jetbrains.buildServer.dotnet.VSTestToolResolver" id="vstestToolResolver">
        <constructor-arg ref="dotnetToolResolver"/>
    </bean>

    <bean class="jetbrains.buildServer.dotnet.DotnetVSTestLoggerArgumentsProvider" id="dotnetVSTestLoggerArgumentsProvider" />
    <bean class="jetbrains.buildServer.dotnet.MSBuildVSTestLoggerArgumentsProvider" id="msbuildVSTestLoggerArgumentsProvider" />
    <bean class="jetbrains.buildServer.dotnet.MSBuildLoggerArgumentsProvider" id="msbuildLoggerArgumentsProvider" />
    <bean class="jetbrains.buildServer.dotnet.VSTestLoggerArgumentsProvider" id="vstestLoggerArgumentsProvider" />
    <bean class="jetbrains.buildServer.dotnet.DotnetCommonArgumentsProviderImpl" id="dotnetCommonArgumentsProviderImpl">
        <constructor-arg ref="msbuildLoggerArgumentsProvider"/>
        <constructor-arg ref="dotnetCustomArgumentsProvider"/>
    </bean>

    <bean class="jetbrains.buildServer.dotnet.BuildCommand" id="dotnetBuildCommand"/>
    <bean class="jetbrains.buildServer.dotnet.NugetDeleteCommand" id="dotnetNugetDeleteCommand"/>
    <bean class="jetbrains.buildServer.dotnet.NugetPushCommand" id="dotnetNugetPushCommand"/>
    <bean class="jetbrains.buildServer.dotnet.PackCommand" id="dotnetPackCommand"/>
    <bean class="jetbrains.buildServer.dotnet.PublishCommand" id="dotnetPublishCommand"/>
    <bean class="jetbrains.buildServer.dotnet.RestoreCommand" id="dotnetCommand"/>
    <bean class="jetbrains.buildServer.dotnet.RunCommand" id="dotnetRunCommand"/>
    <bean class="jetbrains.buildServer.dotnet.TestCommand" id="dotnetTestCommand">
        <constructor-arg ref="dotnetVSTestLoggerArgumentsProvider"/>
    </bean>
    <bean class="jetbrains.buildServer.dotnet.CleanCommand" id="dotnetCleanCommand"/>
    <bean class="jetbrains.buildServer.dotnet.MSBuildCommand" id="dotnetMSBuildCommand">
        <constructor-arg ref="msbuildLoggerArgumentsProvider"/>
        <constructor-arg ref="msbuildVSTestLoggerArgumentsProvider"/>
        <constructor-arg ref="dotnetCustomArgumentsProvider"/>
        <constructor-arg ref="msbuildToolResolver"/>
    </bean>
    <bean class="jetbrains.buildServer.dotnet.VSTestCommand" id="dotnetVSTestCommand">
        <constructor-arg ref="vstestLoggerArgumentsProvider"/>
        <constructor-arg ref="dotnetCustomArgumentsProvider"/>
        <constructor-arg ref="vstestToolResolver"/>
    </bean>

    <!-- dotCover workflow composer -->
    <bean class="jetbrains.buildServer.dotcover.DotCoverWorkflowComposer" id="dotCoverWorkflowComposer" />
    <bean class="jetbrains.buildServer.dotcover.DotCoverProjectSerializerImpl"/>
    <bean class="jetbrains.buildServer.dotcover.CoverageFilterProviderImpl"/>
    <bean class="jetbrains.buildServer.dotcover.DotCoverFilterConverter"/>
</beans>